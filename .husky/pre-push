#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-push hook to run type-check before allowing push
cd "$(git rev-parse --show-toplevel)/code" || exit 1

echo "üîç Running type-check before push..."

# Try to find pnpm in common locations
PNPM_CMD=""
if command -v pnpm &> /dev/null; then
  PNPM_CMD="pnpm"
elif [ -f "$HOME/.local/share/pnpm/pnpm" ]; then
  PNPM_CMD="$HOME/.local/share/pnpm/pnpm"
elif [ -f "/usr/local/bin/pnpm" ]; then
  PNPM_CMD="/usr/local/bin/pnpm"
elif [ -f "$HOME/.pnpm/pnpm" ]; then
  PNPM_CMD="$HOME/.pnpm/pnpm"
fi

if [ -z "$PNPM_CMD" ]; then
  echo "‚ö†Ô∏è  Warning: pnpm not found, skipping type-check"
  echo "   Install pnpm: npm install -g pnpm"
  echo "   Or configure PATH to include pnpm location"
  exit 0  # Allow push but warn
fi

if "$PNPM_CMD" type-check; then
  echo "‚úÖ Type-check passed! Proceeding with push..."
else
  echo "‚ùå Type-check failed! Push aborted."
  exit 1
fi




